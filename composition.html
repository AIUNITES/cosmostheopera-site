<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Composition Guide - COSMOS the OPERA</title>
  <meta name="description" content="Complete AI composition and orchestration guide for COSMOS the OPERA - a trance opera with full orchestra, electronic elements, and cosmic soundscapes.">
  <meta name="keywords" content="opera composition, AI music, orchestration guide, trance opera, music composition, opera instrumentation">
  <meta name="author" content="Tom Sans / AIUNITES">
  
  <!-- Open Graph -->
  <meta property="og:title" content="AI Composition Guide - COSMOS the OPERA">
  <meta property="og:description" content="Detailed composition and orchestration guide for creating a trance opera with cosmic themes.">
  <meta property="og:url" content="https://cosmostheopera.com/composition.html">
  <meta property="og:type" content="article">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¼</text></svg>">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --text-primary: #ffffff;
      --text-secondary: #a0a0b0;
      --accent-purple: #9d4edd;
      --accent-cyan: #00d4ff;
      --accent-gold: #ffd700;
      --accent-pink: #ff6b9d;
      --accent-green: #4ade80;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.7;
    }
    
    /* Navigation */
    .nav {
      background: var(--bg-card);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .nav-logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent-gold);
      text-decoration: none;
    }
    
    .nav-links {
      display: flex;
      gap: 25px;
    }
    
    .nav-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.95rem;
      transition: color 0.3s;
    }
    
    .nav-links a:hover, .nav-links a.active {
      color: var(--accent-cyan);
    }
    
    /* Hero */
    .hero {
      padding: 80px 20px;
      text-align: center;
      background: 
        radial-gradient(ellipse at 70% 30%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
        var(--bg-dark);
    }
    
    .hero h1 {
      font-size: clamp(2.5rem, 6vw, 4rem);
      margin-bottom: 20px;
      background: linear-gradient(135deg, #fff, var(--accent-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hero-subtitle {
      font-size: 1.2rem;
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto;
    }
    
    /* Content */
    .content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 60px 20px;
    }
    
    .section {
      margin-bottom: 60px;
    }
    
    .section h2 {
      font-size: 1.8rem;
      margin-bottom: 25px;
      color: var(--accent-gold);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .section h2::before {
      content: "";
      width: 5px;
      height: 30px;
      background: linear-gradient(180deg, var(--accent-purple), var(--accent-cyan));
      border-radius: 3px;
    }
    
    .section h3 {
      font-size: 1.3rem;
      margin: 30px 0 15px;
      color: var(--accent-cyan);
    }
    
    .section p {
      color: var(--text-secondary);
      margin-bottom: 15px;
    }
    
    /* Instrument Grid */
    .instrument-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .instrument-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 25px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .instrument-card h4 {
      color: var(--accent-cyan);
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    
    .instrument-card ul {
      list-style: none;
      padding: 0;
    }
    
    .instrument-card li {
      color: var(--text-secondary);
      padding: 5px 0;
      font-size: 0.95rem;
    }
    
    .instrument-card li::before {
      content: "â€¢ ";
      color: var(--accent-gold);
    }
    
    /* Scene Cards */
    .scene-card {
      background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(0, 212, 255, 0.05));
      border-radius: 15px;
      padding: 30px;
      margin: 30px 0;
      border-left: 4px solid var(--accent-purple);
    }
    
    .scene-card h3 {
      color: var(--accent-gold);
      margin-bottom: 10px;
    }
    
    .scene-meta {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }
    
    .scene-meta span {
      background: rgba(255,255,255,0.1);
      padding: 5px 12px;
      border-radius: 20px;
      color: var(--accent-cyan);
    }
    
    .scene-card p {
      color: var(--text-secondary);
    }
    
    /* Musical Elements */
    .musical-element {
      background: var(--bg-card);
      border-radius: 10px;
      padding: 20px;
      margin: 15px 0;
    }
    
    .musical-element h4 {
      color: var(--accent-pink);
      margin-bottom: 10px;
      font-size: 1rem;
    }
    
    /* Code Block */
    .code-block {
      background: #1a1a2e;
      border-radius: 10px;
      padding: 25px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      overflow-x: auto;
      border: 1px solid rgba(255,255,255,0.1);
      margin: 20px 0;
      white-space: pre-wrap;
      line-height: 1.5;
    }
    
    /* Voice Table */
    .voice-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: var(--bg-card);
      border-radius: 15px;
      overflow: hidden;
    }
    
    .voice-table th,
    .voice-table td {
      padding: 15px 20px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .voice-table th {
      background: rgba(157, 78, 221, 0.2);
      color: var(--accent-cyan);
      font-weight: 600;
    }
    
    .voice-table tr:last-child td {
      border-bottom: none;
    }
    
    /* Motif Card */
    .motif-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .motif-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .motif-name {
      color: var(--accent-gold);
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .motif-desc {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    /* Performance Note */
    .performance-note {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 10px;
      padding: 20px;
      border-left: 4px solid var(--accent-gold);
      margin: 20px 0;
    }
    
    .performance-note h4 {
      color: var(--accent-gold);
      margin-bottom: 10px;
    }
    
    /* Footer */
    .footer {
      background: var(--bg-card);
      padding: 40px 20px;
      text-align: center;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    
    .footer p {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .footer a {
      color: var(--accent-purple);
      text-decoration: none;
    }
    
    /* Composer Embed Styles */
    .composer-section {
      background: linear-gradient(180deg, rgba(157,78,221,0.1) 0%, transparent 100%);
      padding: 40px 20px;
      margin: 60px 0;
    }
    
    .composer-section-header {
      text-align: center;
      max-width: 800px;
      margin: 0 auto 30px;
    }
    
    .composer-section-header h2 {
      font-size: 2rem;
      color: var(--accent-gold);
      margin-bottom: 15px;
    }
    
    .composer-section-header p {
      color: var(--text-secondary);
    }
    
    .composer-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    @media (max-width: 1024px) {
      .composer-container { grid-template-columns: 1fr; }
    }
    
    .panel {
      background: var(--bg-card);
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .panel-header {
      background: rgba(157,78,221,0.2);
      padding: 15px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .panel-header h3 {
      font-size: 1.1rem;
      color: var(--accent-gold);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .panel-content {
      padding: 20px;
      flex: 1;
      overflow-y: auto;
      max-height: 500px;
    }
    
    .lyrics-input {
      width: 100%;
      min-height: 120px;
      background: #1a1a24;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
      margin-bottom: 20px;
    }
    
    .lyrics-input:focus {
      outline: none;
      border-color: var(--accent-cyan);
    }
    
    .lyrics-input::placeholder {
      color: var(--text-secondary);
    }
    
    .options-section {
      margin-bottom: 20px;
    }
    
    .options-section h4 {
      font-size: 0.95rem;
      color: var(--accent-cyan);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 8px;
    }
    
    .option-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: #1a1a24;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.85rem;
    }
    
    .option-item:hover {
      border-color: var(--accent-purple);
      background: rgba(157,78,221,0.1);
    }
    
    .option-item.selected {
      border-color: var(--accent-green);
      background: rgba(74,222,128,0.1);
    }
    
    .option-item .icon { font-size: 1.1rem; }
    .option-item .label { flex: 1; }
    
    .option-item .check {
      width: 16px;
      height: 16px;
      border: 2px solid var(--text-secondary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .option-item.selected .check {
      border-color: var(--accent-green);
      background: var(--accent-green);
    }
    
    .option-item.selected .check::after {
      content: '';
      width: 6px;
      height: 6px;
      background: #000;
      border-radius: 50%;
    }
    
    .select-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 15px;
    }
    
    .select-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .select-group label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    
    .select-group select {
      background: #1a1a24;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px 12px;
      color: var(--text-primary);
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    .select-group select:focus {
      outline: none;
      border-color: var(--accent-cyan);
    }
    
    .generate-btn {
      width: 100%;
      padding: 14px 25px;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
      border: none;
      border-radius: 10px;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }
    
    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(157,78,221,0.4);
    }
    
    .output-actions {
      display: flex;
      gap: 8px;
    }
    
    .output-btn {
      background: rgba(0,212,255,0.2);
      border: 1px solid var(--accent-cyan);
      color: var(--accent-cyan);
      padding: 6px 12px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s;
    }
    
    .output-btn:hover {
      background: rgba(0,212,255,0.3);
    }
    
    .output-btn.save-btn {
      background: rgba(74,222,128,0.2);
      border-color: var(--accent-green);
      color: var(--accent-green);
    }
    
    .output-actions-wrapper { display: flex; flex-direction: column; gap: 8px; align-items: flex-end; }
    .output-actions { display: flex; gap: 8px; }
    .voice-actions { display: flex; gap: 8px; align-items: center; }
    
    /* Voice Selector Checkboxes */
    .voice-options { display: flex; gap: 8px; flex-wrap: wrap; }
    .voice-checkbox { display: flex; align-items: center; gap: 4px; background: #1a1a24; border: 1px solid rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
    .voice-checkbox:hover { border-color: var(--accent-cyan); }
    .voice-checkbox input { display: none; }
    .voice-checkbox input:checked + span { color: var(--accent-green); }
    .voice-checkbox:has(input:checked) { border-color: var(--accent-green); background: rgba(74,222,128,0.1); }
    .loop-btn { background: rgba(157,78,221,0.2); border: 1px solid var(--accent-purple); color: var(--accent-purple); }
    .loop-btn.active { background: rgba(255,215,0,0.2); border-color: var(--accent-gold); color: var(--accent-gold); }
    
    /* Lyrics Input with Mic */
    .lyrics-input-wrapper { position: relative; margin-bottom: 20px; }
    .lyrics-input-wrapper .lyrics-input { margin-bottom: 0; padding-right: 50px; }
    .mic-btn { position: absolute; right: 10px; top: 10px; width: 36px; height: 36px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
    .mic-btn:hover { border-color: var(--accent-cyan); background: rgba(0,212,255,0.1); }
    .mic-btn.recording { border-color: #ff4444; background: rgba(255,68,68,0.2); animation: pulse-recording 1s infinite; }
    .mic-btn .mic-icon { font-size: 1.2rem; }
    @keyframes pulse-recording { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    
    .score-output {
      background: #1a1a24;
      border-radius: 10px;
      padding: 20px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      line-height: 1.4;
      white-space: pre;
      overflow-x: auto;
      min-height: 350px;
      color: var(--text-secondary);
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .composer-cta {
      text-align: center;
      margin-top: 30px;
      padding: 25px;
      background: rgba(157,78,221,0.1);
      border-radius: 15px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .composer-cta p {
      color: var(--text-secondary);
      margin-bottom: 15px;
    }
    
    .composer-cta a {
      display: inline-block;
      padding: 12px 25px;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
      color: #fff;
      text-decoration: none;
      border-radius: 25px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .composer-cta a:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(157,78,221,0.4);
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--bg-card);
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
      padding: 15px 25px;
      border-radius: 10px;
      z-index: 2000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast.error {
      border-color: var(--accent-pink);
      color: var(--accent-pink);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .nav {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
      }
      
      .instrument-grid,
      .motif-grid {
        grid-template-columns: 1fr;
      }
      
      .scene-meta {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <a href="index.html" class="nav-logo">ğŸŒŒ COSMOS</a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="notation.html">Vocal Notation</a>
      <a href="composition.html" class="active">AI Composition</a>
      <a href="gallery.html">Hubble Gallery</a>
      <a href="sheet-music.html">Sheet Music</a>
      <a href="words.html">Words</a>
      <a href="composer.html">Composer</a>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero">
    <h1>ğŸ¼ AI Composition Guide</h1>
    <p class="hero-subtitle">
      Complete orchestration and musical composition guide for COSMOS the OPERA â€” 
      a trance opera blending electronic elements with full symphony orchestra.
    </p>
    <nav style="display: flex; justify-content: center; gap: 12px; margin-top: 20px; flex-wrap: wrap;">
      <a href="#musical-overview" style="color: var(--accent-gold); text-decoration: none; padding: 10px 18px; background: rgba(255,215,0,0.15); border: 1px solid rgba(255,215,0,0.3); border-radius: 25px; font-size: 0.9rem; transition: all 0.3s;">ğŸµ Musical Overview</a>
      <a href="#ai-sheet-music" style="color: var(--accent-cyan); text-decoration: none; padding: 10px 18px; background: rgba(0,212,255,0.15); border: 1px solid rgba(0,212,255,0.3); border-radius: 25px; font-size: 0.9rem; transition: all 0.3s;">ğŸ¤– AI Sheet Music</a>
      <a href="#composer-tool" style="color: var(--accent-pink); text-decoration: none; padding: 10px 18px; background: rgba(255,107,157,0.15); border: 1px solid rgba(255,107,157,0.3); border-radius: 25px; font-size: 0.9rem; transition: all 0.3s;">ğŸ¼ Composer Tool</a>
    </nav>
  </section>

  <!-- Main Content -->
  <main class="content">
    
    <!-- Overview -->
    <section class="section" id="musical-overview">
      <h2>Musical Overview</h2>
      <p>
        COSMOS the OPERA fuses the driving rhythms and euphoric melodies of trance music with 
        the expressive, dramatic vocals and arrangements of opera. The result is a cosmic 
        soundscape that carries the listener through consciousness, perception, and connection.
      </p>
      
      <div class="performance-note">
        <h4>ğŸ“‹ Performance Specifications</h4>
        <ul style="color: var(--text-secondary); padding-left: 20px;">
          <li><strong>Duration:</strong> Approximately 100 minutes (Act I: 35 min, Act II: 25 min, Act III: 40 min)</li>
          <li><strong>Orchestra Size:</strong> 90-100 musicians</li>
          <li><strong>Amplification:</strong> Unamplified except for synthesizer elements</li>
          <li><strong>Recording Recommendation:</strong> Large concert hall with warm acoustics; consider immersive sound design</li>
        </ul>
      </div>
    </section>

    <!-- Instrumentation -->
    <section class="section">
      <h2>Instrumentation</h2>
      
      <div class="instrument-grid">
        <div class="instrument-card">
          <h4>ğŸ» Strings</h4>
          <ul>
            <li>16 First Violins</li>
            <li>14 Second Violins</li>
            <li>12 Violas</li>
            <li>10 Cellos</li>
            <li>8 Double Basses</li>
          </ul>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸº Brass</h4>
          <ul>
            <li>4 Horns</li>
            <li>3 Trumpets</li>
            <li>3 Trombones</li>
            <li>1 Tuba</li>
          </ul>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸª• Woodwinds</h4>
          <ul>
            <li>3 Flutes (3rd doubling Piccolo)</li>
            <li>2 Oboes, English Horn</li>
            <li>3 Clarinets, Bass Clarinet</li>
            <li>3 Bassoons, Contrabassoon</li>
          </ul>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ¥ Percussion</h4>
          <ul>
            <li>Timpani</li>
            <li>Suspended Cymbals, Gong, Tam-tam</li>
            <li>Tubular Bells, Vibraphone, Glockenspiel</li>
            <li>Triangle, Bass Drum</li>
          </ul>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ¹ Keyboards</h4>
          <ul>
            <li>2 Harps</li>
            <li>Celesta</li>
            <li>Synthesizer (cosmic soundscapes)</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Voices -->
    <section class="section">
      <h2>Vocal Requirements</h2>
      
      <table class="voice-table">
        <thead>
          <tr>
            <th>Voice</th>
            <th>Character</th>
            <th>Range</th>
            <th>Requirements</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Soprano</strong></td>
            <td>The Light / The Universe</td>
            <td>E4-C6</td>
            <td>Coloratura facility, sustained high notes</td>
          </tr>
          <tr>
            <td><strong>Mezzo-Soprano</strong></td>
            <td>The Observer / The Soul</td>
            <td>A3-B5</td>
            <td>Depth and warmth in middle register</td>
          </tr>
          <tr>
            <td><strong>Tenor</strong></td>
            <td>The Sun / The Seeker</td>
            <td>C3-Bâ™­4</td>
            <td>Lyric voice with heroic quality</td>
          </tr>
          <tr>
            <td><strong>Baritone</strong></td>
            <td>The Twin / The Mirror</td>
            <td>G2-G4</td>
            <td>Rich, grounded tone (Finale only)</td>
          </tr>
          <tr>
            <td><strong>SATB Chorus</strong></td>
            <td>The Cosmos / Humanity</td>
            <td>Full range</td>
            <td>Mixed chorus, varied textures</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Scene Breakdowns -->
    <section class="section">
      <h2>Scene-by-Scene Composition</h2>
      
      <h3>ACT I: We Come</h3>
      
      <div class="scene-card">
        <h3>Overture: "Genesis"</h3>
        <div class="scene-meta">
          <span>â±ï¸ 5 minutes</span>
          <span>ğŸµ Largo misterioso â†’ Andante luminoso</span>
          <span>ğŸ”‘ C minor â†’ C major</span>
        </div>
        <p>
          Opens in profound silence, then a single low C in the double basses (pppp), barely audible. 
          Gradually, overtones emerge: cellos add a perfect fifth, violas a major third. 
          The orchestra builds in a slow, expanding harmonic series mimicking the birth of light from darkness.
        </p>
        <div class="musical-element">
          <h4>Notable Effects</h4>
          <p>String harmonics creating "stellar shimmer," synthesizer pads suggesting cosmic background radiation.</p>
        </div>
      </div>
      
      <div class="scene-card">
        <h3>Scene 1: "Do You See"</h3>
        <div class="scene-meta">
          <span>ğŸ¤ Mezzo-Soprano + Chorus</span>
          <span>ğŸµ Moderato contemplativo â™©=72</span>
          <span>ğŸ”‘ C major / A minor (ambiguous)</span>
        </div>
        <p>
          The opening question "do you see" begins unaccompanied on middle C, then descends a minor third (haunting, inward). 
          The phrase "when you close your eyes" rises chromatically, suggesting the paradox of inner vision.
        </p>
        <div class="musical-element">
          <h4>Orchestration</h4>
          <p>Sparse strings (sul tasto) create a veiled, introspective quality. Harp arpeggios in whole tones. 
          Vibraphone adds shimmer on "light." Chorus enters in whispered spoken-sung texture.</p>
        </div>
        <div class="musical-element">
          <h4>Climax on "infinite number of stars"</h4>
          <p>Full orchestra enters fortissimo. Soprano joins on high B-flat, sustained over churning string figures. 
          Glockenspiel cascades suggesting countless stars. Key modulates to E-flat major (brightness).</p>
        </div>
      </div>
      
      <div class="scene-card">
        <h3>Scene 4: "I Sing"</h3>
        <div class="scene-meta">
          <span>ğŸ¤ Full Chorus + Soprano solo</span>
          <span>ğŸµ Allegro gioioso â™©=126</span>
          <span>ğŸ”‘ D major</span>
        </div>
        <p>
          Jubilant, anthemic, affirmative. "I sing to your soul" opens homophonic, forte, all voices in unison rhythm. 
          Brass fanfares punctuate.
        </p>
        <div class="musical-element">
          <h4>Main Theme: "We want to be free"</h4>
          <p>Melodic line is pentatonic (D-E-F#-A-B), suggesting universality and folk-like simplicity. 
          This becomes the principal theme of Act I, building through three iterations with increasing intensity.</p>
        </div>
      </div>
      
      <h3>ACT II: Into</h3>
      
      <div class="scene-card">
        <h3>Scene 1: "The Colors"</h3>
        <div class="scene-meta">
          <span>ğŸ¤ Soprano (Light)</span>
          <span>ğŸµ Allegretto leggiero â™©=96</span>
          <span>ğŸ”‘ G major with constant modulations</span>
        </div>
        <p>
          Shimmering, iridescent, ecstatic. Soprano entrance is high and bright (high G), 
          with melismatic runs on "colors" (16th note flourishes). Coloratura passages throughout suggest dancing light.
        </p>
        <div class="musical-element">
          <h4>Kaleidoscopic Effect</h4>
          <p>Harmonic progression moves through a circle of major thirds (Gâ†’Bâ†’Eâ™­â†’G), 
          creating a prismatic effect. Each key illuminated with different orchestral colors.</p>
        </div>
        <div class="musical-element">
          <h4>Climax</h4>
          <p>"The colors of your love" refrain repeated three times: G major (p, tender), A major (mf, growing), 
          Bâ™­ major (f, passionate). Final: Soprano soars to high C, held for 6 beats over shimmering orchestral tremolo.</p>
        </div>
      </div>
      
      <div class="scene-card">
        <h3>Scene 2: "The Waves"</h3>
        <div class="scene-meta">
          <span>ğŸ¤ Mezzo-Soprano + Chorus</span>
          <span>ğŸµ Andante ondeggiante â™©=69</span>
          <span>ğŸ”‘ E minor / G major (modal interchange)</span>
        </div>
        <p>
          Hypnotic, meditative, building to ecstatic revelation. Undulating patterns in strings 
          (3 against 4 polyrhythm) create a sense of oceanic motion.
        </p>
        <div class="musical-element">
          <h4>"Everything is one"</h4>
          <p>Sudden stillness. Solo mezzo-soprano, unaccompanied, on a single pitch (middle E), sustained for 4 beats. 
          Chorus gradually hums the same note, one voice at a time, building into a rich E major chord.</p>
        </div>
      </div>
      
      <h3>ACT III: Beings</h3>
      
      <div class="scene-card">
        <h3>Scene 1: "I the Sun"</h3>
        <div class="scene-meta">
          <span>ğŸ¤ Soprano + Tenor duet</span>
          <span>ğŸµ Andante appassionato</span>
          <span>ğŸ”‘ Eâ™­ major / C minor (ambiguous)</span>
        </div>
        <p>
          Yearning, passionate, tinged with melancholy of separation. Twin suns reach toward each other 
          but never quite touch â€” call and response, never singing together until "see the sun as one."
        </p>
        <div class="musical-element">
          <h4>Duet Technique</h4>
          <p>Soprano and tenor sing increasingly intertwined lines but always in call-and-response. 
          First unison on "if we could only see the sun as one" (middle G), soft and tender, harp only.</p>
        </div>
      </div>
      
      <div class="scene-card">
        <h3>Scene 3: "Feeling Again" â€” CLIMAX</h3>
        <div class="scene-meta">
          <span>ğŸ¤ Tenor â†’ Soprano + Tenor</span>
          <span>ğŸµ Andante espressivo â†’ Allegro con fuoco â™©=132</span>
          <span>ğŸ”‘ D major â†’ E major</span>
        </div>
        <p>
          From tender reminiscence to passionate declaration. This scene contains the climactic moment 
          of the entire opera.
        </p>
        <div class="musical-element">
          <h4>Ultimate Climax: "and show you what love can do"</h4>
          <p><strong>TENOR:</strong> E7 (extreme high note for tenor role) sustained with full power.<br>
          <strong>SOPRANO:</strong> A7 (stratospheric high A) brilliant, triumphant.<br>
          Both voices hold for 12 beats over radiant D major chord, fff, slow diminuendo to forte.</p>
        </div>
      </div>
      
      <div class="scene-card">
        <h3>Finale: "The Eternal Return"</h3>
        <div class="scene-meta">
          <span>ğŸ¤ All Forces</span>
          <span>ğŸµ Adagio â†’ Moderato â†’ Maestoso</span>
          <span>ğŸ”‘ Returns to C major</span>
        </div>
        <p>
          All themes return, woven into culminating counterpoint. All melodic lines converge on a single note â€” 
          middle C â€” the note that began the opera. Then expand outward into a C major chord spanning 
          the full range from lowest to highest possible notes.
        </p>
        <div class="musical-element">
          <h4>Final Measures</h4>
          <p>Chord held for 12 beats (fff), then 16-beat diminuendo until only the highest note remains â€” 
          a single piccolo playing high C (pppp), like a distant star. Silence. 
          Conductor holds 8 beats before lowering baton.</p>
        </div>
      </div>
    </section>

    <!-- Thematic Motifs -->
    <section class="section">
      <h2>Thematic Musical Motifs</h2>
      <p>These recurring motifs weave throughout the opera, transformed and recombined:</p>
      
      <div class="motif-grid">
        <div class="motif-card">
          <div class="motif-name">1. The Light Motif</div>
          <p class="motif-desc">Ascending major scale fragments, often in parallel motion. Represents illumination and awareness.</p>
        </div>
        
        <div class="motif-card">
          <div class="motif-name">2. The Question Motif</div>
          <p class="motif-desc">Rising minor thirds followed by falling fifths. Used for "do you see" and other questions.</p>
        </div>
        
        <div class="motif-card">
          <div class="motif-name">3. The Unity Motif</div>
          <p class="motif-desc">Converging melodic lines meeting on unison. Represents connection and oneness.</p>
        </div>
        
        <div class="motif-card">
          <div class="motif-name">4. The Separation Motif</div>
          <p class="motif-desc">Diverging lines moving in contrary motion. Represents the longing of twin suns.</p>
        </div>
        
        <div class="motif-card">
          <div class="motif-name">5. The Wave Motif</div>
          <p class="motif-desc">Undulating scalar patterns in irregular rhythms. Oceanic, cosmic flow.</p>
        </div>
        
        <div class="motif-card">
          <div class="motif-name">6. The Love Motif</div>
          <p class="motif-desc">Warm parallel thirds, resolving to consonant harmony. Tenderness and affection.</p>
        </div>
        
        <div class="motif-card">
          <div class="motif-name">7. The Cosmos Motif</div>
          <p class="motif-desc">Sustained chords with slowly shifting overtones. Vastness and eternity.</p>
        </div>
      </div>
    </section>

    <!-- Musical Influences -->
    <section class="section">
      <h2>Musical Influences</h2>
      <p>The composition draws from multiple traditions:</p>
      
      <div class="instrument-grid">
        <div class="instrument-card">
          <h4>ğŸ­ Wagner</h4>
          <p style="color: var(--text-secondary);">Rich harmonic language, leitmotifs, through-composed structure</p>
        </div>
        
        <div class="instrument-card">
          <h4>âœ¨ Messiaen</h4>
          <p style="color: var(--text-secondary);">Cosmic spirituality, modes of limited transposition, orchestral color</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸµ John Adams</h4>
          <p style="color: var(--text-secondary);">Rhythmic vitality, minimalist pulse, tonal accessibility</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸŒŠ Kaija Saariaho</h4>
          <p style="color: var(--text-secondary);">Spectral textures, electronic integration, ethereal atmospheres</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ§ Trance Music</h4>
          <p style="color: var(--text-secondary);">4/4 driving beat (130-138 BPM), builds and breakdowns, euphoric climaxes</p>
        </div>
      </div>
    </section>

    <!-- AI Sheet Music Creation -->
    <section class="section" id="ai-sheet-music">
      <h2>AI Sheet Music Creation</h2>
      <p>
        The ASCII sheet music for COSMOS the OPERA was created using Claude AI with carefully designed prompts 
        and structured templates. This section documents the prompts, notation systems, and methodologies 
        used to generate consistent, readable musical scores in text format.
      </p>
      
      <h3>ğŸ¯ Overview of Notation Systems</h3>
      <p>
        Multiple ASCII notation formats were developed for this opera, each serving different purposes 
        and levels of detail:
      </p>
      
      <div class="instrument-grid">
        <div class="instrument-card">
          <h4>ğŸ“‹ Solo Staff Notation</h4>
          <p style="color: var(--text-secondary);">Detailed measure-by-measure notation with dots on horizontal staff lines and pitch names. 
          Best for: Solo arias, detailed vocal study, precise pitch tracking.</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ¼ SSAATTBB Arrow Notation</h4>
          <p style="color: var(--text-secondary);">Condensed arrow-notation (â™©D4 â”€â†’ â™©E4) showing melodic flow. 
          Best for: Quick reading, audio synthesis, melodic direction.</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ­ SSAATTBB Full Texture</h4>
          <p style="color: var(--text-secondary);">All 8 voice parts listed with pitch sequences (S1: E5â€”F5â€”G5). 
          Best for: Choral rehearsal, part learning, harmonic analysis.</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸµ SSAATTBB Chord Notation</h4>
          <p style="color: var(--text-secondary);">All parts on one line (S1: D5, S2: B4, A1: G4...). 
          Best for: Final chords, sustained harmonies, vertical voicing.</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ‘¥ Dual Voice Dialogue</h4>
          <p style="color: var(--text-secondary);">Side-by-side staves showing two characters in dialogue. 
          Best for: Duets, call-and-response, dramatic interplay.</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ”Š Antiphonal Grouping</h4>
          <p style="color: var(--text-secondary);">HIGH VOICES / LOW VOICES separation with grouped pitch sequences. 
          Best for: Spatial effects, echo passages, contrast.</p>
        </div>
      </div>
      
      <h3>ğŸ“ SATB Notation Elements</h3>
      <p>The detailed SATB notation uses the following ASCII elements:</p>
      
      <table class="voice-table">
        <thead>
          <tr>
            <th>Element</th>
            <th>Symbol</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Box Frame</strong></td>
            <td style="font-family: monospace;">â”Œâ”€â”â”‚â””â”˜</td>
            <td>Unicode box-drawing characters create measure boundaries</td>
          </tr>
          <tr>
            <td><strong>Staff Lines</strong></td>
            <td style="font-family: monospace;">â”€â”€â”€â”€â”€â”€â”€â”€â”€</td>
            <td>Horizontal lines represent pitch positions (e.g., C4, D4, E4)</td>
          </tr>
          <tr>
            <td><strong>Quarter Note</strong></td>
            <td style="font-family: monospace;">â™©</td>
            <td>Standard note marker on staff line</td>
          </tr>
          <tr>
            <td><strong>Half/Whole Note</strong></td>
            <td style="font-family: monospace;">â—</td>
            <td>Filled circle for sustained notes</td>
          </tr>
          <tr>
            <td><strong>Vibrato</strong></td>
            <td style="font-family: monospace;">~~~~~~~</td>
            <td>Tildes indicate sustained vibrato</td>
          </tr>
          <tr>
            <td><strong>Breath Mark</strong></td>
            <td style="font-family: monospace;">'</td>
            <td>Apostrophe indicates breath point</td>
          </tr>
          <tr>
            <td><strong>VRN Codes</strong></td>
            <td style="font-family: monospace;">[CM], [H++]</td>
            <td>Vocal Resonance Notation in brackets</td>
          </tr>
        </tbody>
      </table>
      
      <div class="scene-card">
        <h3>SATB Notation Example</h3>
        <div class="code-block" style="white-space: pre; font-size: 12px;">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEASURE 1-2                                              p (piano - soft)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  A4 â”€â”€â”€â”€â”€â”€â”€â™©â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  C4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©â”€â”€â”€â”€â”€â”€â”€â™©â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€(rest)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  B3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                             â”‚
â”‚       â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚       â•‘  [CM]      [C]       [C]       [C]                               â•‘ â”‚
â”‚       â•‘  "do       you       see"      "what"                            â•‘ â”‚
â”‚       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  Resonance: Chest-mix descending to full chest voice, tender, questioning   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
      </div>
      
      <h3>ğŸ“ SSAATTBB Notation Elements</h3>
      <p>The condensed 8-part chorus format uses streamlined arrow notation:</p>
      
      <table class="voice-table">
        <thead>
          <tr>
            <th>Element</th>
            <th>Symbol</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Note Arrow</strong></td>
            <td style="font-family: monospace;">â™©D4 â”€â†’ â™©E4</td>
            <td>Shows melodic direction and pitch sequence</td>
          </tr>
          <tr>
            <td><strong>Sustained</strong></td>
            <td style="font-family: monospace;">â—G5~~~~~~~~</td>
            <td>Long note with duration indicated by tildes</td>
          </tr>
          <tr>
            <td><strong>Climax Marker</strong></td>
            <td style="font-family: monospace;">â˜… CLIMAX â˜…</td>
            <td>Highlights dramatic high points</td>
          </tr>
          <tr>
            <td><strong>Voice Parts</strong></td>
            <td style="font-family: monospace;">S1, S2, A1, A2, T1, T2, B1, B2</td>
            <td>8-part choir designation</td>
          </tr>
          <tr>
            <td><strong>Wave Entry</strong></td>
            <td style="font-family: monospace;">B2â†’S1</td>
            <td>Staggered entry direction (Bass 2 to Soprano 1)</td>
          </tr>
        </tbody>
      </table>
      
      <div class="scene-card">
        <h3>SSAATTBB Notation Example</h3>
        <div class="code-block" style="white-space: pre; font-size: 12px;">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚  MEASURES 41-60: "an infinite number of stars"             ff â˜… CLIMAX â˜…
â”‚  â™©D4 â”€â†’ â™©F#4 â”€â†’ â™©A4 â”€â†’ â™©D5 â”€â†’ â™©F#5 â”€â†’ â—A5~~~~~~~~              [H+++â†’N++â†’Oc+â†’H+++â†’H+++â†’H+++]
â”‚  "an      in-     fi-     nite    num-    ber of â˜…STARS!â˜…~~~~~~~~"   fff
â”‚  SSAATTBB: Full 8-part texture, S1 descant to A5               fff [H+++,O+++]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
      </div>
      
      <h3>ğŸ“ SSAATTBB Full Texture Format</h3>
      <p>When all 8 voice parts need individual pitch sequences, the Full Texture format lists each part:</p>
      
      <div class="scene-card">
        <h3>Full 8-Part Texture Example</h3>
        <div class="code-block" style="white-space: pre; font-size: 11px;">SSAATTBB - FULL 8-PART TEXTURE:

S1 (descant): G5â€”A5â€”Bb5â€”C6 â—~~~~~~~~~~~~  "stars... stars..."  fff [H+++]
S2 (doubles): G4â€”A4â€”Bb4â€”C5â€”D5â€”Eb5â€”F5â€”G5  f [H++]
A1:           Eb4â€”F4â€”G4â€”Ab4â€”Bb4 â—~~~~~~   "swirling..."  f [H++, M+]
A2:           C4â€”D4â€”Eb4â€”F4â€”G4 â—~~~~~~    mf [M++, H+]
T1:           G3â€”A3â€”Bb3â€”C4â€”D4â€”Eb4        "infinite..."  f [M++, O++]
T2:           Eb3â€”F3â€”G3â€”Ab3â€”Bb3â€”C4       mf [M+, C+]
B1:           Bb3â€”F3â€”G3â€”Ab3 â—~~~~~~~~~~  "stars swirling"  f [C++, P+]
B2 (pedal):   Eb2â€”â€”â€”â€”â€”Bb2â€”â€”â€”â€”â€”Eb2â€”â€”â€”â€”â€”Bb2  f [C+++]

ORCHESTRA TUTTI: Fl 1-3 scalar fff, Brass Eb major ff, Timp Eb-Bb, Harps gliss</div>
      </div>
      
      <h3>ğŸ“ SSAATTBB Chord Notation</h3>
      <p>For sustained chords or final harmonies, all 8 parts are shown on a single line:</p>
      
      <div class="scene-card">
        <h3>Chord Notation Example</h3>
        <div class="code-block" style="white-space: pre; font-size: 11px;">SSAATTBB (final G major chord, fading):
S1: D5    S2: B4    A1: G4    A2: D4    T1: B3    T2: G3    B1: D3    B2: G2
p > pp, [H+, M(R)]

ORCHESTRA: Strings dim to ppp, Harp final G arpeggio, Celesta single G5, Silence</div>
      </div>
      
      <h3>ğŸ“ Dual Voice Dialogue Format</h3>
      <p>When two characters sing in dialogue, side-by-side staves show the interplay:</p>
      
      <div class="scene-card">
        <h3>Dialogue Notation Example</h3>
        <div class="code-block" style="white-space: pre; font-size: 11px;">SEEKER + LIGHT (Soprano enters in dialogue):

SEEKER:                              LIGHT:
F#5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—.~~~~~~            E5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©
E5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              D5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©
D5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©              C5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—~~
C5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©
B4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©
A4 â”€â”€â”€â”€â”€â”€â”€â”€â™©â”€â”€â”€â”€                      "through all space..."  p [H+++]
G4 â”€â”€â”€â”€â™©

"it can see through all space and time through this journey that is mine"</div>
      </div>
      
      <h3>ğŸ“ Antiphonal Grouping Format</h3>
      <p>For echo effects or spatial separation, voices are grouped as HIGH and LOW:</p>
      
      <div class="scene-card">
        <h3>Antiphonal Notation Example</h3>
        <div class="code-block" style="white-space: pre; font-size: 11px;">SSAATTBB - ANTIPHONAL RESPONSE:

HIGH VOICES respond "what is it":
S1: E5â€”D5â€”C5â€”B4    S2: C5â€”B4â€”A4â€”G4    A1: A4â€”G4â€”F4â€”E4    A2: E4â€”D4â€”C4â€”B3
mp [H++, N+]

LOW VOICES respond "the echo":
T1: E3â€”D3â€”C3       T2: C3â€”B2â€”A2       B1: A2â€”G2â€”F2       B2: E2â€”D2â€”C2
mp [C++, P++, Oc+]

ORCHESTRA: Eng Horn dialogues, Strings pp, Harp echo figures, Celesta crystalline</div>
      </div>
      
      <h3>ğŸ“ Orchestra Tutti Lines</h3>
      <p>Each section includes orchestration notes showing instrumental texture:</p>
      
      <table class="voice-table">
        <thead>
          <tr>
            <th>Element</th>
            <th>Example</th>
            <th>Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Instrument Groups</strong></td>
            <td style="font-family: monospace;">Fl 1-3, Brass, Strings</td>
            <td>Which instruments are playing</td>
          </tr>
          <tr>
            <td><strong>Technique</strong></td>
            <td style="font-family: monospace;">scalar, gliss, tremolo</td>
            <td>How they're playing</td>
          </tr>
          <tr>
            <td><strong>Harmony</strong></td>
            <td style="font-family: monospace;">Eb major, A minor</td>
            <td>Chord or key being played</td>
          </tr>
          <tr>
            <td><strong>Dynamics</strong></td>
            <td style="font-family: monospace;">ff, dim to ppp</td>
            <td>Volume and changes</td>
          </tr>
          <tr>
            <td><strong>Specific Notes</strong></td>
            <td style="font-family: monospace;">Timp Eb-Bb, Celesta G5</td>
            <td>Particular pitches for instruments</td>
          </tr>
        </tbody>
      </table>
      
      <h3>ğŸ“ Character Voice Designations</h3>
      <p>The opera uses specific character names for solo voices throughout the scores:</p>
      
      <table class="voice-table">
        <thead>
          <tr>
            <th>Character</th>
            <th>Voice Type</th>
            <th>Dramatic Role</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>OBSERVER</strong></td>
            <td>Mezzo-Soprano</td>
            <td>The questioning soul, narrator of consciousness</td>
          </tr>
          <tr>
            <td><strong>SEEKER</strong></td>
            <td>Tenor</td>
            <td>The journeying spirit, searching for meaning</td>
          </tr>
          <tr>
            <td><strong>LIGHT</strong></td>
            <td>Soprano</td>
            <td>Universal illumination, cosmic awareness</td>
          </tr>
          <tr>
            <td><strong>VISIONARY</strong></td>
            <td>Soprano</td>
            <td>Transcendent voice, ethereal perspective</td>
          </tr>
        </tbody>
      </table>
      
      <h3>ğŸ“ Extended VRN Codes</h3>
      <p>Beyond the primary resonance codes, these additional markers appear in the scores:</p>
      
      <table class="voice-table">
        <thead>
          <tr>
            <th>Code</th>
            <th>Meaning</th>
            <th>Usage</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="font-family: monospace;">[M(R)]</td>
            <td>Muscular Release</td>
            <td>Relaxed muscle engagement for fading passages</td>
          </tr>
          <tr>
            <td style="font-family: monospace;">[Ey+]</td>
            <td>Eye Muscles</td>
            <td>Mask resonance, "smiling" placement</td>
          </tr>
          <tr>
            <td style="font-family: monospace;">[B+]</td>
            <td>Brow Muscles</td>
            <td>Lifted placement for brightness</td>
          </tr>
          <tr>
            <td style="font-family: monospace;">[Oc+]</td>
            <td>Occipital</td>
            <td>Back-of-head resonance for fullness</td>
          </tr>
          <tr>
            <td style="font-family: monospace;">[SP+]</td>
            <td>Soft Palate</td>
            <td>Raised palate for open sound</td>
          </tr>
          <tr>
            <td style="font-family: monospace;">[P+]</td>
            <td>Pharynx</td>
            <td>Throat space, darker color</td>
          </tr>
          <tr>
            <td style="font-family: monospace;">[VRNâ†’VRNâ†’VRN]</td>
            <td>VRN Progression</td>
            <td>Shows resonance shift through a phrase</td>
          </tr>
        </tbody>
      </table>
      
      <h3>ğŸ¤– AI Prompts & Templates</h3>
      <p>
        The following prompts were developed to generate consistent ASCII sheet music. 
        These can be adapted for your own musical notation projects.
      </p>
      
      <div class="scene-card">
        <h3>Base System Prompt Template</h3>
        <div class="scene-meta">
          <span>ğŸ“‹ For initializing Claude</span>
        </div>
        <div class="code-block" style="white-space: pre-wrap; font-size: 11px;">You are an expert music notation assistant specializing in creating ASCII sheet music 
for opera and choral works. You understand:
- Traditional music notation (pitch, rhythm, dynamics, tempo)
- Vocal Resonance Notation (VRN) codes: [C]=Chest, [H]=Head, [M]=Mix, [N]=Nasal, [O]=Oral
- VRN intensity levels: + (slight), ++ (moderate), +++ (maximum)
- Mixed voice designations: [CM]=Chest-Mix, [HM]=Head-Mix
- Unicode box-drawing characters for score layout
- Proper measure structure and time signatures

When creating scores, you will:
1. Use consistent box-drawing characters (â”Œâ”€â”â”‚â””â”˜â”¬â”´â”œâ”¤â•”â•â•—â•‘â•šâ•)
2. Place pitch names on the left margin (C4, D4, E4, etc.)
3. Use â™© for quarter notes, â— for sustained notes, ~~~~~~ for vibrato
4. Include VRN codes in brackets below lyrics
5. Add performance annotations (dynamics, tempo, resonance descriptions)</div>
      </div>
      
      <div class="scene-card">
        <h3>SATB Score Generation Prompt</h3>
        <div class="scene-meta">
          <span>ğŸ¤ For detailed solo/ensemble scores</span>
        </div>
        <div class="code-block" style="white-space: pre-wrap; font-size: 11px;">Create an ASCII vocal score for the following text in SATB format:

Text: "[LYRICS HERE]"
Voice: [VOICE TYPE - Soprano/Mezzo/Tenor/Baritone/Chorus]
Tempo: [TEMPO MARKING] â™©= [BPM]
Key: [KEY SIGNATURE]
Time Signature: [4/4, 3/4, etc.]
Mood: [DESCRIPTION]

Requirements:
1. Create measure-by-measure notation with box-drawing frame
2. Show each pitch on its own staff line (e.g., A4, B4, C5)
3. Include VRN codes matching the emotional content:
   - Intimate/questioning: [CM], [C+], [O++]
   - Building/ascending: [M], [HM], [H++]
   - Climactic/powerful: [H+++], [N++], [Oc+]
4. Place lyrics in a text box below staff using â•”â•â•â•â•—/â•‘/â•šâ•â•â•â•
5. Add resonance description line at bottom
6. Use appropriate dynamics (p, mp, mf, f, ff, fff)

Output format example:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEASURE [N]                           [dynamic]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [pitch] â”€â”€â”€â”€â”€â”€â”€â™©â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [pitch] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â™©â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                         â”‚
â”‚       â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—â”‚
â”‚       â•‘  [VRN]    [VRN]    [VRN]                       â•‘â”‚
â”‚       â•‘  "word    word     word"                       â•‘â”‚
â”‚       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
â”‚  Resonance: [Description of vocal placement and feel]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>
      </div>
      
      <div class="scene-card">
        <h3>SSAATTBB Score Generation Prompt</h3>
        <div class="scene-meta">
          <span>ğŸ¼ For 8-part choral scores</span>
        </div>
        <div class="code-block" style="white-space: pre-wrap; font-size: 11px;">Create an ASCII SSAATTBB orchestral choral score:

Text: "[LYRICS HERE]"
Solo Voice: [VOICE TYPE] (optional)
Tempo: [TEMPO MARKING] â™©= [BPM]
Key: [KEY SIGNATURE]
Measures: [START]-[END]

Format Requirements:
1. Use condensed arrow notation: â™©[PITCH] â”€â†’ â™©[PITCH]
2. Show melodic direction with arrows (ascending â†‘ or descending â†“)
3. Mark sustained notes: â—[PITCH]~~~~~~~~
4. Include VRN progression: [VRNâ†’VRNâ†’VRN]
5. Describe chorus texture (wave entry, staggered, unison)
6. Mark climax points with â˜… CLIMAX â˜…
7. Voice parts: S1, S2, A1, A2, T1, T2, B1, B2

Output format:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚  MEASURES [N]-[M]: "[section title]"                    [dynamic] [marker]
â”‚  â™©[P1] â”€â†’ â™©[P2] â”€â†’ â™©[P3] â”€â†’ â—[P4]~~~~~~~~  ([direction]) [VRN sequence]
â”‚  "[lyrics aligned with notes]"
â”‚  SSAATTBB: [Chorus instruction]                         [dynamic] [VRN]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
      </div>
      
      <div class="scene-card">
        <h3>VRN Assignment Prompt</h3>
        <div class="scene-meta">
          <span>ğŸµ For automatic resonance coding</span>
        </div>
        <div class="code-block" style="white-space: pre-wrap; font-size: 11px;">Analyze the following lyrics and assign appropriate VRN codes based on:

1. PITCH CONTEXT:
   - Low notes (below E4): Favor [C], [C+], [CM]
   - Mid notes (E4-A4): Favor [M], [CM], [HM], [O++]
   - High notes (above A4): Favor [H], [H++], [H+++], [N++]

2. EMOTIONAL CONTENT:
   - Questioning/intimate: [O++], [CM], [P+]
   - Ascending/transcendent: [H++], [N+], [Ey+]
   - Powerful/climactic: [H+++], [O+++], [Oc+++], [M+++]
   - Grounded/heavy: [C++], [L+], [T+]
   - Ethereal/light: [H], [N++], [SP+]

3. WORD PAINTING:
   - "light/stars/sky": [H+++], [N++], [Ey+] (bright mask)
   - "earth/ground/deep": [C++], [P+], [T+] (grounded chest)
   - "love/soul/heart": [CM], [O++], [M+] (warm middle)
   - "universe/cosmos/infinite": [H+++], [Oc+++], [M+++] (full expansion)

Text to analyze: "[LYRICS]"
Mood: [MOOD DESCRIPTION]
Voice type: [SOPRANO/MEZZO/TENOR/BASS]</div>
      </div>
      
      <h3>ğŸ“ Workflow Example</h3>
      <p>Here's the complete workflow for generating a scene's sheet music:</p>
      
      <div class="performance-note">
        <h4>Step 1: Prepare the Source Material</h4>
        <p style="color: var(--text-secondary); margin-bottom: 10px;">Gather the lyrics, identify the emotional arc, and determine key/tempo/time signature.</p>
      </div>
      
      <div class="performance-note">
        <h4>Step 2: Generate SATB Score</h4>
        <p style="color: var(--text-secondary); margin-bottom: 10px;">Use the SATB prompt template with your lyrics to create detailed measure notation for study and rehearsal.</p>
      </div>
      
      <div class="performance-note">
        <h4>Step 3: Generate SSAATTBB Score</h4>
        <p style="color: var(--text-secondary); margin-bottom: 10px;">Use the SSAATTBB prompt to create the condensed choral version with audio synthesis markers.</p>
      </div>
      
      <div class="performance-note">
        <h4>Step 4: Apply VRN Codes</h4>
        <p style="color: var(--text-secondary); margin-bottom: 10px;">Use the VRN assignment prompt to ensure resonance markings match the emotional and physical demands of each phrase.</p>
      </div>
      
      <div class="performance-note">
        <h4>Step 5: Review & Refine</h4>
        <p style="color: var(--text-secondary); margin-bottom: 10px;">Check pitch ranges, VRN consistency, and notation clarity. Iterate with Claude to refine specific measures.</p>
      </div>
      
      <h3>ğŸ”§ Advanced Techniques</h3>
      
      <div class="instrument-grid">
        <div class="instrument-card">
          <h4>ğŸ­ Multi-Voice Scenes</h4>
          <p style="color: var(--text-secondary);">For duets and ensembles, specify each voice's melodic line separately, then ask Claude to interleave them with call-and-response or parallel notation.</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ“Š Climax Building</h4>
          <p style="color: var(--text-secondary);">Request gradual dynamic and VRN progressions: start at p with [C+], build through mf with [M], peak at fff with [H+++, O+++, M+++].</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ¹ Audio Integration</h4>
          <p style="color: var(--text-secondary);">The SSAATTBB format was designed to integrate with Tone.js for browser-based audio playback with measure-by-measure auto-scrolling.</p>
        </div>
        
        <div class="instrument-card">
          <h4>ğŸ“ Consistent Spacing</h4>
          <p style="color: var(--text-secondary);">Use monospace font (Courier New) and fixed-width box characters to ensure alignment across all browsers and devices.</p>
        </div>
      </div>
    </section>

    <!-- Interactive Composer Tool -->
    <section class="section" id="composer-tool">
      <h2>ğŸ¼ Interactive Composer Tool</h2>
      <p>
        Try the COSMOS Music Composer Tool below â€” transform your words into sheet music instantly. 
        This captivating tool generates ASCII notation with VRN codes, multiple notation formats, 
        and various musical styles inspired by the opera.
      </p>
      
      <!-- Embedded Composer -->
      <div class="composer-container" style="max-height: none;">
        <!-- Input Panel -->
        <div class="panel">
          <div class="panel-header">
            <h3>âœï¸ Your Words & Options</h3>
          </div>
          <div class="panel-content" style="max-height: none;">
            <div class="lyrics-input-wrapper">
              <textarea class="lyrics-input" id="lyricsInput" placeholder="Enter your lyrics or words here...

Example:
do you see
what do you see
when you close your eyes
i see the light
an infinite number of stars"></textarea>
              <button class="mic-btn" id="micBtn" onclick="toggleSpeechRecognition()" title="Click to record voice">
                <span class="mic-icon">ğŸ™ï¸</span>
              </button>
            </div>
            
            <!-- Notation Format -->
            <div class="options-section">
              <h4>ğŸ“‹ Notation Format</h4>
              <div class="options-grid" id="notationOptions">
                <label class="option-item option-radio" data-value="piano-roll">
                  <span class="icon">ğŸ¹</span>
                  <span class="label">Piano Roll</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio selected" data-value="treble-bass">
                  <span class="icon">ğŸ¼</span>
                  <span class="label">Treble/Bass</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio" data-value="ssaattbb">
                  <span class="icon">ğŸ­</span>
                  <span class="label">SSAATTBB</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio" data-value="lead-sheet">
                  <span class="icon">ğŸ“„</span>
                  <span class="label">Lead Sheet</span>
                  <span class="check"></span>
                </label>
              </div>
            </div>
            
            <!-- Dynamics -->
            <div class="options-section">
              <h4>ğŸ”Š Dynamics & Expression</h4>
              <div class="options-grid" id="dynamicsOptions">
                <label class="option-item selected" data-value="traditional">
                  <span class="icon">ğŸµ</span>
                  <span class="label">Traditional</span>
                  <span class="check"></span>
                </label>
                <label class="option-item selected" data-value="vrn">
                  <span class="icon">ğŸ—£ï¸</span>
                  <span class="label">VRN Codes</span>
                  <span class="check"></span>
                </label>
                <label class="option-item" data-value="expressive">
                  <span class="icon">ğŸ’«</span>
                  <span class="label">Expressive</span>
                  <span class="check"></span>
                </label>
              </div>
            </div>
            
            <!-- Musical Style -->
            <div class="options-section">
              <h4>ğŸ¨ Musical Style</h4>
              <div class="options-grid" id="styleOptions">
                <label class="option-item option-radio selected" data-value="operatic">
                  <span class="icon">ğŸ­</span>
                  <span class="label">Operatic</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio" data-value="hypnotic">
                  <span class="icon">ğŸŒ€</span>
                  <span class="label">Hypnotic</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio" data-value="trance">
                  <span class="icon">âœ¨</span>
                  <span class="label">Trance</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio" data-value="classical">
                  <span class="icon">ğŸ›ï¸</span>
                  <span class="label">Classical</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio" data-value="jazz">
                  <span class="icon">ğŸ·</span>
                  <span class="label">Jazz</span>
                  <span class="check"></span>
                </label>
                <label class="option-item option-radio" data-value="folk">
                  <span class="icon">ğŸª•</span>
                  <span class="label">Folk</span>
                  <span class="check"></span>
                </label>
              </div>
            </div>
            
            <!-- Parameters -->
            <div class="options-section">
              <h4>âš™ï¸ Parameters</h4>
              <div class="select-row">
                <div class="select-group">
                  <label>Key</label>
                  <select id="keySelect">
                    <option value="C">C Major</option>
                    <option value="G">G Major</option>
                    <option value="D">D Major</option>
                    <option value="F">F Major</option>
                    <option value="Am">A Minor</option>
                    <option value="Em">E Minor</option>
                  </select>
                </div>
                <div class="select-group">
                  <label>Tempo</label>
                  <select id="tempoSelect">
                    <option value="60">Largo (60)</option>
                    <option value="72" selected>Andante (72)</option>
                    <option value="90">Moderato (90)</option>
                    <option value="120">Allegro (120)</option>
                  </select>
                </div>
              </div>
              <div class="select-row">
                <div class="select-group">
                  <label>Time</label>
                  <select id="timeSelect">
                    <option value="4/4">4/4</option>
                    <option value="3/4">3/4</option>
                    <option value="6/8">6/8</option>
                  </select>
                </div>
                <div class="select-group">
                  <label>Voice</label>
                  <select id="voiceSelect">
                    <option value="soprano">Soprano</option>
                    <option value="mezzo" selected>Mezzo</option>
                    <option value="tenor">Tenor</option>
                    <option value="baritone">Baritone</option>
                  </select>
                </div>
              </div>
            </div>
            
            <button class="generate-btn" onclick="generateScore()">
              <span>ğŸµ</span> Generate Sheet Music
            </button>
          </div>
        </div>
        
        <!-- Output Panel -->
        <div class="panel">
          <div class="panel-header">
            <h3>ğŸ“œ Generated Score</h3>
            <div class="output-actions-wrapper">
              <div class="output-actions">
                <button class="output-btn play-btn" id="playBtn" onclick="playScore()">â–¶ï¸ Play</button>
                <button class="output-btn" id="pauseBtn" onclick="pauseScore()" style="display:none;">â¸ï¸ Pause</button>
                <button class="output-btn" id="stopBtn" onclick="stopScore()">â¹ï¸ Stop</button>
                <button class="output-btn" onclick="copyScore()">ğŸ“‹ Copy</button>
                <button class="output-btn" onclick="downloadScore()">ğŸ’¾ Download</button>
              </div>
              <div class="voice-actions">
                <div class="voice-options" id="voiceOptions">
                  <label class="voice-checkbox" title="Pure tone"><input type="checkbox" value="pure" checked onchange="changeVoice()"><span>ğŸµ</span></label>
                  <label class="voice-checkbox" title="Choir pad"><input type="checkbox" value="choir" onchange="changeVoice()"><span>ğŸ™ï¸</span></label>
                  <label class="voice-checkbox" title="Organ"><input type="checkbox" value="organ" onchange="changeVoice()"><span>ğŸ¹</span></label>
                  <label class="voice-checkbox" title="Strings"><input type="checkbox" value="strings" onchange="changeVoice()"><span>ğŸ»</span></label>
                  <label class="voice-checkbox" title="Rich harmonics"><input type="checkbox" value="rich" onchange="changeVoice()"><span>âœ¨</span></label>
                </div>
                <button class="output-btn loop-btn" id="loopBtn" onclick="toggleLoop()">â†» Loop</button>
              </div>
            </div>
          </div>
          <!-- Playback Progress -->
          <div id="playbackProgress" style="display:none; padding: 10px 20px; background: rgba(157,78,221,0.2); border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
              <span id="currentNote" style="color: var(--accent-cyan); font-weight: 600; min-width: 50px;">Ready</span>
              <div style="flex: 1; min-width: 100px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent-purple), var(--accent-pink)); transition: width 0.1s;"></div>
              </div>
              <span id="playbackTime" style="color: var(--text-secondary); font-size: 0.85rem;">0:00</span>
            </div>
          </div>
          <div class="panel-content" style="max-height: none;">
            <div class="output-tabs">
              <button class="tab-btn active" onclick="switchTab('score')">Score</button>
              <button class="tab-btn" onclick="switchTab('vrn')">VRN Guide</button>
            </div>
            <div class="score-output" id="scoreOutput" style="min-height: 500px;">Enter lyrics and click Generate to create sheet music...</div>
          </div>
        </div>
      </div>
      
      <!-- Toast -->
      <div class="toast" id="toast"></div>
      
      <div class="performance-note" style="margin-top: 30px;">
        <h4>ğŸ’¡ Composer Features</h4>
        <ul style="color: var(--text-secondary); padding-left: 20px;">
          <li><strong>Multiple Notation Formats:</strong> Piano Roll, Treble/Bass, SSAATTBB, Lead Sheet</li>
          <li><strong>Musical Styles:</strong> Operatic, Hypnotic, Trance, Classical, Jazz, Folk</li>
          <li><strong>VRN Integration:</strong> Automatic Vocal Resonance Notation codes</li>
          <li><strong>Customizable:</strong> Key, tempo, time signature, and voice type</li>
          <li><strong>Save & Share:</strong> Create an account to save your compositions</li>
        </ul>
      </div>
    </section>

    <!-- Staging Suggestions -->
    <section class="section">
      <h2>Staging Suggestions</h2>
      
      <div class="performance-note">
        <h4>ğŸ¬ Visual Design</h4>
        <ul style="color: var(--text-secondary); padding-left: 20px;">
          <li>Minimal, abstract sets using light and projection</li>
          <li>Projections of cosmic imagery (nebulae, stars, galaxies, light waves)</li>
          <li>Soloists often spotlit against darkness</li>
          <li>Chorus positioned on risers behind orchestra, becoming part of the cosmic backdrop</li>
        </ul>
      </div>
      
      <div class="performance-note">
        <h4>ğŸ­ Interpretive Notes</h4>
        <ul style="color: var(--text-secondary); padding-left: 20px;">
          <li>Balance intellectual/cerebral with deeply emotional/spiritual</li>
          <li>Repeating texts should not feel redundant but mantra-like, each repetition revealing new depth</li>
          <li>The opera is fundamentally about consciousness, connection, and the nature of existence</li>
        </ul>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>
      Â© 2002-2026 COSMOS the OPERA. All Rights Reserved. DMCA Protected.<br>
      <a href="index.html">Back to Home</a> | 
      <a href="notation.html">Vocal Resonance Notation</a> |
      <a href="#ai-sheet-music">AI Sheet Music Creation</a>
    </p>
  </footer>

  <script>
    // ==================== OPTION HANDLING ====================
    document.querySelectorAll('.option-item').forEach(item => {
      item.addEventListener('click', function() {
        const parent = this.parentElement;
        const isRadio = this.classList.contains('option-radio');
        if (isRadio) {
          parent.querySelectorAll('.option-item').forEach(i => i.classList.remove('selected'));
        }
        this.classList.toggle('selected', isRadio || !this.classList.contains('selected'));
      });
    });

    function getSelectedOptions(containerId) {
      return [...document.getElementById(containerId).querySelectorAll('.option-item.selected')].map(i => i.dataset.value);
    }

    function getSelectedRadio(containerId) {
      const sel = document.getElementById(containerId).querySelector('.option-item.selected');
      return sel ? sel.dataset.value : null;
    }

    // ==================== TOAST ====================
    function showToast(message, isError = false) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show' + (isError ? ' error' : '');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ==================== COMPOSER ENGINE ====================
    const voiceRanges = {
      soprano: { scale: ['C4','D4','E4','F4','G4','A4','B4','C5','D5','E5','F5','G5','A5','B5','C6'] },
      mezzo: { scale: ['A3','B3','C4','D4','E4','F4','G4','A4','B4','C5','D5','E5','F5','G5','A5'] },
      tenor: { scale: ['C3','D3','E3','F3','G3','A3','B3','C4','D4','E4','F4','G4','A4','B4','C5'] },
      baritone: { scale: ['A2','B2','C3','D3','E3','F3','G3','A3','B3','C4','D4','E4','F4','G4','A4'] }
    };

    const stylePatterns = {
      operatic: { intervals: [2,3,4,5,7], dynamics: ['p','mp','mf','f','ff','fff'] },
      hypnotic: { intervals: [1,2,3], dynamics: ['p','mp','mf'] },
      trance: { intervals: [2,3,5], dynamics: ['p','mf','f','ff'] },
      classical: { intervals: [2,3,4,5], dynamics: ['p','mp','mf','f'] },
      jazz: { intervals: [1,2,3,4,6,7], dynamics: ['mp','mf','f'] },
      folk: { intervals: [2,3,5], dynamics: ['mp','mf'] }
    };

    function getVRNCode(pitch, emotion, intensity) {
      const noteNum = parseInt(pitch.slice(-1));
      let code = noteNum <= 3 ? 'C' : (noteNum === 4 ? 'M' : 'H');
      return `[${code}${'+'.repeat(Math.min(3, intensity))}]`;
    }

    function parseLyrics(text) {
      const lines = text.trim().split('\n').filter(l => l.trim());
      const words = [];
      lines.forEach((line, lineIdx) => {
        line.trim().split(/\s+/).forEach((word, wordIdx, arr) => {
          if (word) words.push({ text: word.toLowerCase(), isLineStart: wordIdx === 0, isLineEnd: wordIdx === arr.length - 1, lineNum: lineIdx });
        });
      });
      return words;
    }

    function generateMelody(words, voice, style) {
      const range = voiceRanges[voice];
      const pattern = stylePatterns[style];
      const melody = [];
      let currentIdx = Math.floor(range.scale.length / 2);
      
      words.forEach((word, i) => {
        const progress = i / words.length;
        const emotion = progress > 0.7 ? 'powerful' : (progress < 0.3 ? 'tender' : 'building');
        const intensity = Math.ceil(progress * 3);
        let interval = pattern.intervals[Math.floor(Math.random() * pattern.intervals.length)];
        let direction = Math.random() > 0.5 ? 1 : -1;
        if (progress > 0.5) direction = 1;
        if (word.isLineStart && i > 0) currentIdx = Math.max(currentIdx - 2, 2);
        currentIdx = Math.max(0, Math.min(range.scale.length - 1, currentIdx + (direction * interval)));
        if (progress > 0.8 && progress < 0.9) currentIdx = Math.min(currentIdx + 3, range.scale.length - 2);
        
        melody.push({
          word: word.text, pitch: range.scale[currentIdx], vrn: getVRNCode(range.scale[currentIdx], emotion, intensity),
          dynamic: pattern.dynamics[Math.min(Math.floor(progress * pattern.dynamics.length), pattern.dynamics.length - 1)],
          isLineStart: word.isLineStart, isLineEnd: word.isLineEnd, lineNum: word.lineNum, emotion
        });
      });
      return melody;
    }

    function generatePianoRollNotation(melody) {
      const key = document.getElementById('keySelect').value;
      const time = document.getElementById('timeSelect').value;
      const tempo = document.getElementById('tempoSelect').value;
      const voice = document.getElementById('voiceSelect').value;
      const style = getSelectedRadio('styleOptions');
      const dynamics = getSelectedOptions('dynamicsOptions');
      
      const lines = [];
      let currentLineNotes = [], currentLineNum = -1;
      melody.forEach(note => {
        if (note.lineNum !== currentLineNum) {
          if (currentLineNotes.length > 0) lines.push(currentLineNotes);
          currentLineNotes = [];
          currentLineNum = note.lineNum;
        }
        currentLineNotes.push(note);
      });
      if (currentLineNotes.length > 0) lines.push(currentLineNotes);
      
      let output = `â”Œ${'\u2500'.repeat(78)}\n\u2502  PIANO ROLL SCORE\n\u2502  Key: ${key}  Time: ${time}  Tempo: \u2669=${tempo}  Voice: ${voice}  Style: ${style}\n\u251c${'\u2500'.repeat(78)}\n`;
      
      let measureNum = 1;
      const noteNames = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
      
      lines.forEach(lineNotes => {
        const pitchNums = lineNotes.map(n => {
          const note = n.pitch.slice(0,-1), octave = parseInt(n.pitch.slice(-1));
          return octave * 12 + noteNames.indexOf(note);
        });
        const minP = Math.min(...pitchNums), maxP = Math.max(...pitchNums);
        const pitchLabels = [];
        for (let p = maxP + 1; p >= minP - 1; p--) {
          pitchLabels.push({ name: noteNames[p % 12] + Math.floor(p / 12), num: p });
        }
        
        const lyricsPreview = lineNotes.map(n => n.word).join(' ');
        output += `\u2502\n\u2502  MEASURES ${measureNum}-${measureNum + 15}: "${lyricsPreview.substring(0,40)}"  ${lineNotes[lineNotes.length-1].dynamic}\n\u2502\n\u2502  ${voice.toUpperCase()}:\n`;
        
        pitchLabels.forEach(pi => {
          let line = `\u2502  ${pi.name.padEnd(4)} `;
          lineNotes.forEach(note => {
            const np = parseInt(note.pitch.slice(-1)) * 12 + noteNames.indexOf(note.pitch.slice(0,-1));
            line += np === pi.num ? (note.isLineEnd ? `${'\u2500'.repeat(6)}\u25cf~~~~~~~` : `${'\u2500'.repeat(6)}\u266a${'\u2500'.repeat(7)}`) : `${'\u2500'.repeat(14)}`;
          });
          output += line + '\n';
        });
        
        if (dynamics.includes('vrn')) {
          output += `\u2502\n\u2502       `;
          lineNotes.forEach(n => output += n.vrn.padEnd(14));
          output += '\n';
        }
        output += `\u2502       `;
        lineNotes.forEach(n => output += `"${n.word}" `.padEnd(14));
        output += `\n\u2502\n\u251c${'\u2500'.repeat(78)}\n`;
        measureNum += 16;
      });
      
      return output + `\u2514${'\u2500'.repeat(78)}\n`;
    }

    let currentGeneratedOutput = '';

    function generateScore() {
      const lyrics = document.getElementById('lyricsInput').value.trim();
      if (!lyrics) { showToast('Enter lyrics first', true); return; }
      
      const voice = document.getElementById('voiceSelect').value;
      const style = getSelectedRadio('styleOptions');
      const words = parseLyrics(lyrics);
      if (words.length === 0) { showToast('No valid words found', true); return; }
      
      const melody = generateMelody(words, voice, style);
      let output = generatePianoRollNotation(melody);
      
      document.getElementById('scoreOutput').textContent = output;
      currentGeneratedOutput = output;
      showToast('Score generated!');
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.textContent.toLowerCase().includes(tab)));
      const output = document.getElementById('scoreOutput');
      if (tab === 'vrn') {
        output.textContent = `
VRN (Vocal Resonance Notation) Quick Guide:

PRIMARY CODES:
[C]  = Chest Voice    - Full chest resonance
[H]  = Head Voice     - Upper resonance, light
[M]  = Mix Voice      - Balanced chest/head

INTENSITY:
+    = Slight
++   = Moderate  
+++  = Maximum

MIXED:
[CM] = Chest-Mix
[HM] = Head-Mix

EXTENDED:
[N]  = Nasal (forward, bright)
[O]  = Oral (open throat)
[Oc] = Occipital (back resonance)
[SP] = Soft Palate (raised)`;
      } else if (currentGeneratedOutput) {
        output.textContent = currentGeneratedOutput;
      }
    }

    function copyScore() {
      const text = document.getElementById('scoreOutput').textContent;
      navigator.clipboard.writeText(text);
      showToast('Copied!');
    }

    function downloadScore() {
      const blob = new Blob([document.getElementById('scoreOutput').textContent], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'cosmos-score.txt';
      a.click();
      showToast('Downloaded!');
    }

    // ==================== AUDIO PLAYBACK ====================
    let audioContext = null;
    let currentMelody = [];
    let isPlaying = false;
    let isPaused = false;
    let playbackIndex = 0;
    let playbackTimeout = null;
    let startTime = 0;
    let pausedAt = 0;

    // Note frequencies (A4 = 440Hz)
    const noteFrequencies = {
      'C2': 65.41, 'C#2': 69.30, 'D2': 73.42, 'D#2': 77.78, 'E2': 82.41, 'F2': 87.31, 'F#2': 92.50, 'G2': 98.00, 'G#2': 103.83, 'A2': 110.00, 'A#2': 116.54, 'B2': 123.47,
      'C3': 130.81, 'C#3': 138.59, 'D3': 146.83, 'D#3': 155.56, 'E3': 164.81, 'F3': 174.61, 'F#3': 185.00, 'G3': 196.00, 'G#3': 207.65, 'A3': 220.00, 'A#3': 233.08, 'B3': 246.94,
      'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
      'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99, 'G#5': 830.61, 'A5': 880.00, 'A#5': 932.33, 'B5': 987.77,
      'C6': 1046.50, 'C#6': 1108.73, 'D6': 1174.66, 'D#6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'F#6': 1479.98, 'G6': 1567.98, 'G#6': 1661.22, 'A6': 1760.00, 'A#6': 1864.66, 'B6': 1975.53
    };

    function initAudio() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioContext.state === 'suspended') {
        audioContext.resume();
      }
    }

    // ==================== VOICE PRESETS ====================
    const voicePresets = {
      pure: { type: 'sine', harmonics: [1, 0, 0], attack: 0.05, decay: 0.1, sustain: 0.7, release: 0.2 },
      choir: { type: 'triangle', harmonics: [1, 0.5, 0.25], attack: 0.1, decay: 0.15, sustain: 0.6, release: 0.3 },
      organ: { type: 'square', harmonics: [1, 0.3, 0.1], attack: 0.02, decay: 0.05, sustain: 0.8, release: 0.1 },
      strings: { type: 'sawtooth', harmonics: [1, 0.7, 0.4], attack: 0.15, decay: 0.2, sustain: 0.5, release: 0.4 },
      rich: { type: 'sine', harmonics: [1, 0.6, 0.3, 0.15], attack: 0.08, decay: 0.12, sustain: 0.65, release: 0.25 }
    };

    let selectedVoices = ['pure'];
    let loopEnabled = false;

    function getSelectedVoices(containerId) {
      const container = document.getElementById(containerId);
      if (!container) return ['pure'];
      const checkboxes = container.querySelectorAll('input[type="checkbox"]:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    function changeVoice() {
      selectedVoices = getSelectedVoices('voiceOptions');
      if (selectedVoices.length === 0) selectedVoices = ['pure'];
    }

    function toggleLoop() {
      loopEnabled = !loopEnabled;
      const btn = document.getElementById('loopBtn');
      if (loopEnabled) {
        btn.classList.add('active');
        btn.innerHTML = 'â†» Loop On';
        showToast('Loop enabled');
      } else {
        btn.classList.remove('active');
        btn.innerHTML = 'â†» Loop';
        showToast('Loop disabled');
      }
    }

    function playNoteWithVoices(frequency, duration, startTime, volume) {
      selectedVoices.forEach(voiceName => {
        const preset = voicePresets[voiceName] || voicePresets.pure;
        const gainNode = audioContext.createGain();
        
        preset.harmonics.forEach((harmonic, i) => {
          if (harmonic <= 0) return;
          const osc = audioContext.createOscillator();
          osc.type = preset.type;
          osc.frequency.setValueAtTime(frequency * (i + 1), startTime);
          
          const oscGain = audioContext.createGain();
          oscGain.gain.setValueAtTime(harmonic * volume / selectedVoices.length, startTime);
          
          osc.connect(oscGain);
          oscGain.connect(gainNode);
          osc.start(startTime);
          osc.stop(startTime + duration);
        });
        
        // ADSR envelope
        gainNode.gain.setValueAtTime(0, startTime);
        gainNode.gain.linearRampToValueAtTime(volume / selectedVoices.length, startTime + preset.attack);
        gainNode.gain.linearRampToValueAtTime(volume * preset.sustain / selectedVoices.length, startTime + preset.attack + preset.decay);
        gainNode.gain.setValueAtTime(volume * preset.sustain / selectedVoices.length, startTime + duration - preset.release);
        gainNode.gain.linearRampToValueAtTime(0, startTime + duration);
        
        gainNode.connect(audioContext.destination);
      });
    }

    function playNote(frequency, duration, startTime, volume = 0.3) {
      playNoteWithVoices(frequency, duration, startTime, volume);
    }

    function playScore() {
      if (currentMelody.length === 0) {
        showToast('Generate a score first', true);
        return;
      }

      initAudio();
      
      if (isPaused) {
        // Resume from paused position
        isPaused = false;
        isPlaying = true;
        updatePlaybackUI();
        playFromIndex(playbackIndex);
        return;
      }

      // Start fresh
      stopScore();
      isPlaying = true;
      playbackIndex = 0;
      startTime = Date.now();
      
      document.getElementById('playbackProgress').style.display = 'block';
      updatePlaybackUI();
      playFromIndex(0);
    }

    function playFromIndex(index) {
      if (!isPlaying || index >= currentMelody.length) {
        if (index >= currentMelody.length) {
          if (loopEnabled) {
            // Loop back to beginning
            playbackIndex = 0;
            startTime = Date.now();
            showToast('Looping...');
            playFromIndex(0);
            return;
          }
          // Playback complete
          stopScore();
          showToast('Playback complete');
        }
        return;
      }

      const note = currentMelody[index];
      const tempo = parseInt(document.getElementById('tempoSelect').value) || 72;
      const beatDuration = 60 / tempo; // Duration of one beat in seconds
      const noteDuration = beatDuration * 0.8; // Note length (slightly shorter than beat)
      
      // Get frequency
      const freq = noteFrequencies[note.pitch];
      if (freq) {
        // Volume based on dynamics
        const dynamicVolumes = { 'ppp': 0.1, 'pp': 0.15, 'p': 0.2, 'mp': 0.25, 'mf': 0.3, 'f': 0.4, 'ff': 0.5, 'fff': 0.6 };
        const volume = dynamicVolumes[note.dynamic] || 0.3;
        
        playNote(freq, noteDuration, audioContext.currentTime, volume);
      }

      // Update UI
      playbackIndex = index;
      updateProgressUI(index, currentMelody.length, note);

      // Schedule next note
      const nextDelay = beatDuration * 1000;
      playbackTimeout = setTimeout(() => {
        playFromIndex(index + 1);
      }, nextDelay);
    }

    function pauseScore() {
      if (isPlaying && !isPaused) {
        isPaused = true;
        isPlaying = false;
        pausedAt = playbackIndex;
        if (playbackTimeout) {
          clearTimeout(playbackTimeout);
          playbackTimeout = null;
        }
        updatePlaybackUI();
        showToast('Paused');
      }
    }

    function stopScore() {
      isPlaying = false;
      isPaused = false;
      playbackIndex = 0;
      pausedAt = 0;
      
      if (playbackTimeout) {
        clearTimeout(playbackTimeout);
        playbackTimeout = null;
      }
      
      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('currentNote').textContent = 'Ready';
      document.getElementById('playbackTime').textContent = '0:00';
      updatePlaybackUI();
    }

    function updatePlaybackUI() {
      const playBtn = document.getElementById('playBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const stopBtn = document.getElementById('stopBtn');
      
      if (isPlaying) {
        playBtn.style.display = 'none';
        pauseBtn.style.display = 'inline-block';
        stopBtn.style.background = 'rgba(255,107,157,0.3)';
      } else if (isPaused) {
        playBtn.innerHTML = 'â–¶ï¸ Resume';
        playBtn.style.display = 'inline-block';
        pauseBtn.style.display = 'none';
        stopBtn.style.background = '';
      } else {
        playBtn.innerHTML = 'â–¶ï¸ Play';
        playBtn.style.display = 'inline-block';
        pauseBtn.style.display = 'none';
        stopBtn.style.background = '';
      }
    }

    function updateProgressUI(current, total, note) {
      const progress = ((current + 1) / total) * 100;
      document.getElementById('progressBar').style.width = progress + '%';
      document.getElementById('currentNote').textContent = `â™ª ${note.pitch} - "${note.word}" ${note.vrn}`;
      
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const mins = Math.floor(elapsed / 60);
      const secs = elapsed % 60;
      document.getElementById('playbackTime').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Override generateScore to store melody for playback
    const originalGenerateScore = generateScore;
    generateScore = function() {
      const lyrics = document.getElementById('lyricsInput').value.trim();
      if (!lyrics) { showToast('Enter lyrics first', true); return; }
      
      const voice = document.getElementById('voiceSelect').value;
      const style = getSelectedRadio('styleOptions');
      const words = parseLyrics(lyrics);
      if (words.length === 0) { showToast('No valid words found', true); return; }
      
      // Generate and store melody for playback
      currentMelody = generateMelody(words, voice, style);
      let output = generatePianoRollNotation(currentMelody);
      
      document.getElementById('scoreOutput').textContent = output;
      currentGeneratedOutput = output;
      
      // Reset playback state
      stopScore();
      document.getElementById('playbackProgress').style.display = 'block';
      document.getElementById('currentNote').textContent = `Ready - ${currentMelody.length} notes`;
      
      showToast('Score generated! Click Play to hear it.');
    };

    // ==================== SPEECH RECOGNITION ====================
    let recognition = null;
    let isRecording = false;

    function initSpeechRecognition() {
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
      } else if ('SpeechRecognition' in window) {
        recognition = new SpeechRecognition();
      } else {
        return null;
      }
      
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'en-US';
      
      recognition.onresult = function(event) {
        const textarea = document.getElementById('lyricsInput');
        let interimTranscript = '';
        let finalTranscript = '';
        
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalTranscript += transcript;
          } else {
            interimTranscript += transcript;
          }
        }
        
        if (finalTranscript) {
          // Add final transcript to textarea
          const currentText = textarea.value;
          const newText = currentText ? currentText + '\n' + finalTranscript.trim() : finalTranscript.trim();
          textarea.value = newText;
        }
      };
      
      recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        if (event.error === 'not-allowed') {
          showToast('Microphone access denied. Please allow microphone access.', true);
        } else {
          showToast('Speech recognition error: ' + event.error, true);
        }
        stopRecording();
      };
      
      recognition.onend = function() {
        if (isRecording) {
          // Restart if still supposed to be recording
          recognition.start();
        }
      };
      
      return recognition;
    }

    function toggleSpeechRecognition() {
      if (isRecording) {
        stopRecording();
      } else {
        startRecording();
      }
    }

    function startRecording() {
      if (!recognition) {
        recognition = initSpeechRecognition();
      }
      
      if (!recognition) {
        showToast('Speech recognition not supported in this browser', true);
        return;
      }
      
      try {
        recognition.start();
        isRecording = true;
        const micBtn = document.getElementById('micBtn');
        micBtn.classList.add('recording');
        micBtn.title = 'Click to stop recording';
        showToast('Recording... Speak your lyrics');
      } catch (e) {
        console.error('Error starting speech recognition:', e);
        showToast('Could not start recording', true);
      }
    }

    function stopRecording() {
      if (recognition) {
        isRecording = false;
        recognition.stop();
      }
      const micBtn = document.getElementById('micBtn');
      micBtn.classList.remove('recording');
      micBtn.title = 'Click to record voice';
      showToast('Recording stopped');
    }
  </script>
</body>
</html>
